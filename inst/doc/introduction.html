<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Mark P.J. van der Loo and Edwin de Jonge" />
  <title>Introduction to dcmodify</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
body {
max-width: 50rem;
margin-left: auto;
margin-right: auto;
font-family: system-ui;
color: lightgray;
background: #555555;
}
p, li {
text-align: justify;
}
pre {
background: #444;
padding: 0.5rem;
}
h1, h2, h3, h4, h5 {
color: orange;
font-weight: bold;
}
h4, h5 {
color: inherit;
}
h2 {
margin-top: 3rem;
}
a {
color: orange;
}
a:hover {
color: lightblue;
}
pre code {
color: white;
background: inherit;
padding: 0;
}
code {
color: #e5c892;
background: #444;
padding: 0.2rem;
}

p.author {
font-weight : bold;
color: orange;
}

code {
color : lightgray;
}
code span.op {
color: #cccccc;
}
code span.kw, code span.cf {
color: #30bd58;
}
code span.st {
color: #76a9db; }
code span.dv, code span.ot, code span.fl{
color: #7fd0a8; }
code span.dt, code span.er {
color: #ee8c70; }
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Introduction to <code>dcmodify</code></h1>
<p class="author">Mark P.J. van der Loo and Edwin de Jonge</p>
</header>
<!--
%\VignetteEngine{simplermarkdown::mdweave_to_html}
%\VignetteIndexEntry{Introduction to dcmodify}
-->
<p><em>Rule-based data processing for data cleaning.</em></p>
<p>Package version 0.8.0.</p>
<p>Please use <code>citation(&quot;dcmodify&quot;)</code> to cite the package.</p>
<h2 id="introduction">Introduction</h2>
<p>The <code>dcmodify</code> package allows users to declare (conditional) data processing steps without hard-coding them in an R script.</p>
<figure>
<img src="data:image/png;base64,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" title="Rule-based data processing" alt="Rule-based data processing" /><figcaption><em>Rule-based data processing</em></figcaption>
</figure>
<p>The motivating use case is where domain experts need to frequently update (fix) values of a data set depending on data conditions. Such updates require (1) selecting the cases where the conditions apply, and (2) updating the values.</p>
<h3 id="example">Example</h3>
<p>We create a dataset where we asked some imaginary respondents about their average water consumption per day.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="op">&gt;</span><span class="st"> </span>water &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Ross&quot;</span>, <span class="st">&quot;Robert&quot;</span>, <span class="st">&quot;Martin&quot;</span>, </a>
<a class="sourceLine" id="cb1-2" title="2"><span class="op">+</span><span class="st">     &quot;Brian&quot;</span>, <span class="st">&quot;Simon&quot;</span>), <span class="dt">consumption =</span> <span class="kw">c</span>(<span class="dv">110</span>, <span class="dv">105</span>, <span class="fl">0.15</span>, <span class="dv">95</span>, <span class="dv">-100</span>))</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="op">&gt;</span><span class="st"> </span>water</a>
<a class="sourceLine" id="cb1-5" title="5">    name consumption</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="dv">1</span>   Ross      <span class="fl">110.00</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="dv">2</span> Robert      <span class="fl">105.00</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="dv">3</span> Martin        <span class="fl">0.15</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="dv">4</span>  Brian       <span class="fl">95.00</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="dv">5</span>  Simon     <span class="fl">-100.00</span></a></code></pre></div>
<p>Here, Martin submitted his water consumption in m<sup>3</sup> while the others responded in liters. Such a unit of measure error can be detected and fixed. Simon took the engineering approach, interpreted consumption as a <em>sink</em>, and put a negative sign in front of his answer. Again, this is a data error that can be detected and fixed easily.</p>
<p>If such errors occur frequently, it makes sense to store the treatment. In <code>dcmodify</code> this can be solved as follows.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dcmodify)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="op">&gt;</span><span class="st"> </span>rules &lt;-<span class="st"> </span><span class="kw">modifier</span>(<span class="cf">if</span> (<span class="kw">abs</span>(consumption) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) consumption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="op">+</span><span class="st">     </span>consumption, <span class="cf">if</span> (consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption)</a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="op">&gt;</span><span class="st"> </span>out &lt;-<span class="st"> </span><span class="kw">modify</span>(water, rules)</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="op">&gt;</span><span class="st"> </span>out</a>
<a class="sourceLine" id="cb2-9" title="9">    name consumption</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="dv">1</span>   Ross         <span class="dv">110</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="dv">2</span> Robert         <span class="dv">105</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="dv">3</span> Martin         <span class="dv">150</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="dv">4</span>  Brian          <span class="dv">95</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="dv">5</span>  Simon         <span class="dv">100</span></a></code></pre></div>
<p>In the first step we define a set of conditional data modifying rules of the form:</p>
<pre><code>if (some condition) change somthing</code></pre>
<p>next, using <code>modifier()</code>, these rules are applied record-wise.</p>
<h2 id="whats-the-idea">What’s the idea</h2>
<p>In <code>dcmodify</code> conditional data modifying rules are first class citizens. Modifying rules can be created, deleted, read from or written to file, filtered, selected, and investigated. And of course, applied to data.</p>
<p>In particular, the <code>rules</code> object of the previous example is basically a list of class <code>modifier</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="op">&gt;</span><span class="st"> </span>rules</a>
<a class="sourceLine" id="cb4-2" title="2">Object of class modifier with <span class="dv">2</span> elements<span class="op">:</span></a>
<a class="sourceLine" id="cb4-3" title="3">M1<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span><span class="cf">if</span> (<span class="kw">abs</span>(consumption) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) consumption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>consumption</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">M2<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  </span><span class="cf">if</span> (consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption</a></code></pre></div>
<p>For example, we may select one rule and apply it to our original data set.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">modify</span>(water, rules[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb5-2" title="2">    name consumption</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="dv">1</span>   Ross      <span class="fl">110.00</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="dv">2</span> Robert      <span class="fl">105.00</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="dv">3</span> Martin        <span class="fl">0.15</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="dv">4</span>  Brian       <span class="fl">95.00</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="dv">5</span>  Simon      <span class="fl">100.00</span></a></code></pre></div>
<p>We can ask which variables are used in the modifying rules (here: only one).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">variables</span>(rules)</a>
<a class="sourceLine" id="cb6-2" title="2">[<span class="dv">1</span>] <span class="st">&quot;consumption&quot;</span></a></code></pre></div>
<h3 id="exercises">Exercises</h3>
<ol type="1">
<li>Load the <code>retailers</code> dataset from the validate package using <code>data(&quot;retailers&quot;, package=&quot;validate&quot;)</code>.</li>
<li>Create a modifier that (1) sets <code>other.rev</code> to zero if it is missing, (2) replaces negative <code>other.rev</code> with the absolute value.</li>
</ol>
<h2 id="importexport-of-rules-and-rule-metadata">Import/export of rules and rule metadata</h2>
<p>The <code>dcmodify</code> package supports reading/writing rules from free text file, <code>yaml</code> files, or data frames. For example, consider the contents of the file <code>myrules.txt</code> (to try the following code, create such a file yourself).</p>
<pre><code># myrules.txt

# unit of measure error
if (abs(consumption) &lt;= 1){
  consumption &lt;- 1000*consumption
}

# sign error
if (consumption &lt; 0 ){
  consumption &lt;- -1 * consumption
}</code></pre>
<p>Reading the rules is done with the <code>.file</code> argument.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="op">&gt;</span><span class="st"> </span>rules &lt;-<span class="st"> </span><span class="kw">modifier</span>(<span class="dt">.file =</span> <span class="st">&quot;myrules.txt&quot;</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">&gt;</span><span class="st"> </span>rules</a>
<a class="sourceLine" id="cb8-4" title="4">Object of class modifier with <span class="dv">2</span> elements<span class="op">:</span></a>
<a class="sourceLine" id="cb8-5" title="5">M1<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st">  </span><span class="cf">if</span> (<span class="kw">abs</span>(consumption) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb8-7" title="7">      consumption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>consumption</a>
<a class="sourceLine" id="cb8-8" title="8">  }</a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10">M2<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st">  </span><span class="cf">if</span> (consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb8-12" title="12">      consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption</a>
<a class="sourceLine" id="cb8-13" title="13">  }</a></code></pre></div>
<p>A second way to store rules is in <a href="https://yaml.org/">yaml</a> format. This allows one to add metadata to rules, including a name, label or description. To demonstrate this, we will write the rules to <code>yaml</code> file and print the file contents.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="op">&gt;</span><span class="st"> </span>fn &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="op">&gt;</span><span class="st"> </span><span class="kw">export_yaml</span>(rules, <span class="dt">file =</span> fn)</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="op">&gt;</span><span class="st"> </span><span class="kw">cat</span>(<span class="kw">paste</span>(<span class="kw">readLines</span>(fn), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb9-6" title="6">rules<span class="op">:</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="op">-</span><span class="st"> </span>expr<span class="op">:</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="st">  </span><span class="op">-</span><span class="st"> </span><span class="cf">if</span> (<span class="kw">abs</span>(consumption) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="op">-</span><span class="st"> &#39;    consumption &lt;- 1000 * consumption&#39;</span></a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="op">-</span><span class="st"> &#39;}&#39;</span></a>
<a class="sourceLine" id="cb9-11" title="11">  name<span class="op">:</span><span class="st"> </span>M1</a>
<a class="sourceLine" id="cb9-12" title="12">  label<span class="op">:</span><span class="st"> &#39;&#39;</span></a>
<a class="sourceLine" id="cb9-13" title="13">  description<span class="op">:</span><span class="st"> &#39;&#39;</span></a>
<a class="sourceLine" id="cb9-14" title="14">  created<span class="op">:</span><span class="st"> </span><span class="dv">2023-04-07</span> <span class="dv">16</span><span class="op">:</span><span class="dv">33</span><span class="op">:</span><span class="dv">00</span></a>
<a class="sourceLine" id="cb9-15" title="15">  origin<span class="op">:</span><span class="st"> </span>myrules.txt</a>
<a class="sourceLine" id="cb9-16" title="16">  meta<span class="op">:</span><span class="st"> </span>[]</a>
<a class="sourceLine" id="cb9-17" title="17"><span class="op">-</span><span class="st"> </span>expr<span class="op">:</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="st">  </span><span class="op">-</span><span class="st"> </span><span class="cf">if</span> (consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb9-19" title="19">  <span class="op">-</span><span class="st"> &#39;    consumption &lt;- -1 * consumption&#39;</span></a>
<a class="sourceLine" id="cb9-20" title="20">  <span class="op">-</span><span class="st"> &#39;}&#39;</span></a>
<a class="sourceLine" id="cb9-21" title="21">  name<span class="op">:</span><span class="st"> </span>M2</a>
<a class="sourceLine" id="cb9-22" title="22">  label<span class="op">:</span><span class="st"> &#39;&#39;</span></a>
<a class="sourceLine" id="cb9-23" title="23">  description<span class="op">:</span><span class="st"> &#39;&#39;</span></a>
<a class="sourceLine" id="cb9-24" title="24">  created<span class="op">:</span><span class="st"> </span><span class="dv">2023-04-07</span> <span class="dv">16</span><span class="op">:</span><span class="dv">33</span><span class="op">:</span><span class="dv">00</span></a>
<a class="sourceLine" id="cb9-25" title="25">  origin<span class="op">:</span><span class="st"> </span>myrules.txt</a>
<a class="sourceLine" id="cb9-26" title="26">  meta<span class="op">:</span><span class="st"> </span>[]</a></code></pre></div>
<p>Finally, it is possible to read rules from (and export to) data frame. A rule data frame must at least contain a <code>character</code> column named <code>rule</code>; all other columns are considered metadata.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="op">&gt;</span><span class="st"> </span>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;U1&quot;</span>, <span class="st">&quot;S1&quot;</span>), <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;Unit error&quot;</span>, </a>
<a class="sourceLine" id="cb10-2" title="2"><span class="op">+</span><span class="st">     &quot;sign error&quot;</span>))</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="op">&gt;</span><span class="st"> </span>d<span class="op">$</span>rule &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;if(abs(consumption)&lt;=1) consuption &lt;- 1000 * consumption&quot;</span>, </a>
<a class="sourceLine" id="cb10-5" title="5"><span class="op">+</span><span class="st">     &quot;if(consumption &lt; 0) consumption &lt;- -1 * consumption&quot;</span>)</a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="op">&gt;</span><span class="st"> </span>d</a>
<a class="sourceLine" id="cb10-8" title="8">  name      label                                                     rule</a>
<a class="sourceLine" id="cb10-9" title="9"><span class="dv">1</span>   U1 Unit error <span class="cf">if</span>(<span class="kw">abs</span>(consumption)<span class="op">&lt;=</span><span class="dv">1</span>) consuption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>consumption</a>
<a class="sourceLine" id="cb10-10" title="10"><span class="dv">2</span>   S1 sign error      <span class="cf">if</span>(consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption</a></code></pre></div>
<p>Reading from data frame is done with the <code>.data</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="op">&gt;</span><span class="st"> </span>myrules &lt;-<span class="st"> </span><span class="kw">modifier</span>(<span class="dt">.data =</span> d)</a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="op">&gt;</span><span class="st"> </span>myrules</a>
<a class="sourceLine" id="cb11-4" title="4">Object of class modifier with <span class="dv">2</span> elements<span class="op">:</span></a>
<a class="sourceLine" id="cb11-5" title="5">U1<span class="op">:</span><span class="st"> </span>Unit error</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="cf">if</span> (<span class="kw">abs</span>(consumption) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) consuption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>consumption</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">S1<span class="op">:</span><span class="st"> </span>sign error</a>
<a class="sourceLine" id="cb11-9" title="9">  <span class="cf">if</span> (consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption</a></code></pre></div>
<h3 id="exercise">Exercise</h3>
<p>Using the <code>retailers</code> dataset of the previous exercises, define a file with rules that</p>
<ul>
<li>fill missing <code>other.rev</code> with zero (0)</li>
<li>detect large staff cost per staff ratios and reduces the staff costs accordingly (unit of measure is 1000s of EUR, while some records are expressed in EUR).</li>
<li>Similar for total revenue and turnover.</li>
</ul>
<p>See <code>?retailers</code> for the meaning of the variables.</p>
<h2 id="supported-rules">Supported rules</h2>
<p>The package supports rules of the form</p>
<pre><code>if (some condition holds){
  change some existing values
} </code></pre>
<p>where the <code>else</code> clause is optional, and the rules are executed record-by-record. There may be multiple expressions in each <code>{}</code> block, and it is also allowed to have nested <code>if-else</code> statements.</p>
<h2 id="tracking-changes">Tracking changes</h2>
<p><code>dcmodify</code> allows rule-by-rule change tracking via integration with the <a href="https://cran.r-project.org/package=lumberjack">lumberjack</a> package[1]. There are many ways of following what happens to a data file, and we refere to [1] for an overview of the possibilities of the <code>lumberjack</code> package. Here we demonstrate how to use the cellwise logger, which logs all changes cell-by-cell.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(lumberjack)</a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="op">&gt;</span><span class="st"> </span>lgr &lt;-<span class="st"> </span>cellwise<span class="op">$</span><span class="kw">new</span>(<span class="dt">key =</span> <span class="st">&quot;name&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="op">&gt;</span><span class="st"> </span>rules &lt;-<span class="st"> </span><span class="kw">modifier</span>(<span class="cf">if</span> (<span class="kw">abs</span>(consumption) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) consumption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="op">+</span><span class="st">     </span>consumption, <span class="cf">if</span> (consumption <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption)</a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="op">&gt;</span><span class="st"> </span>out &lt;-<span class="st"> </span><span class="kw">modify</span>(water, rules, <span class="dt">logger =</span> lgr)</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="op">&gt;</span><span class="st"> </span>logfile &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb13-11" title="11"></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="op">&gt;</span><span class="st"> </span>lgr<span class="op">$</span><span class="kw">dump</span>(<span class="dt">file =</span> logfile)</a>
<a class="sourceLine" id="cb13-13" title="13"></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="op">&gt;</span><span class="st"> </span><span class="kw">read.csv</span>(logfile)</a>
<a class="sourceLine" id="cb13-15" title="15">  step                     time         srcref</a>
<a class="sourceLine" id="cb13-16" title="16"><span class="dv">1</span>    <span class="dv">1</span> <span class="dv">2023-04-07</span> <span class="dv">16</span><span class="op">:</span><span class="dv">33</span><span class="op">:</span><span class="dv">00</span> CEST <span class="op">&lt;</span>modifier<span class="op">&gt;</span><span class="co">#1-1</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="dv">2</span>    <span class="dv">2</span> <span class="dv">2023-04-07</span> <span class="dv">16</span><span class="op">:</span><span class="dv">33</span><span class="op">:</span><span class="dv">00</span> CEST <span class="op">&lt;</span>modifier<span class="op">&gt;</span><span class="co">#2-2</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="st">                         </span>expression    key    variable     old new</a>
<a class="sourceLine" id="cb13-19" title="19"><span class="dv">1</span> consumption &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>consumption Martin consumption    <span class="fl">0.15</span> <span class="dv">150</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="dv">2</span>   consumption &lt;-<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>consumption  Simon consumption <span class="fl">-100.00</span> <span class="dv">100</span></a></code></pre></div>
<h2 id="references">References</h2>
<p>[1] van der Loo MPJ (2021). Monitoring Data in R with the lumberjack Package. <em>Journal of Statistical Software</em>, <strong>98</strong>(1), 1–13. <a href="https://doi.org/10.18637/jss.v098.i01">doi:10.18637/jss.v098.i01</a>.</p>
</body>
</html>
